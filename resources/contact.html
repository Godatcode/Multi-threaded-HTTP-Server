<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>API Testing | HTTP Server</title>
    <link rel="stylesheet" href="/css/testing.css">
</head>
<body>
    <!-- Navigation -->
    <nav>
        <div class="nav-container">
            <div class="logo">🚀 HTTP Server</div>
            <ul class="nav-links">
                <li><a href="/">Home</a></li>
                <li><a href="/about.html">Documentation</a></li>
                <li><a href="/contact.html" class="active">API Testing</a></li>
            </ul>
        </div>
    </nav>
    
    <!-- Page Header -->
    <div class="page-header">
        <h1>Interactive API Testing</h1>
        <p>Test all server endpoints and features in real-time</p>
    </div>
    
    <!-- Main Container -->
    <div class="container">
        <!-- Testing Cards Grid -->
        <div class="testing-grid">
            <!-- POST JSON Upload -->
            <div class="test-card">
                <h2><span class="method-badge badge-post">POST</span> JSON Upload</h2>
                <p>Test the POST /upload endpoint with JSON data. Edit the JSON below or use the default.</p>
                
                <div class="test-input-group">
                    <label for="jsonInput">JSON Data:</label>
                    <textarea id="jsonInput" rows="12">{
  "user": {
    "name": "Test User",
    "email": "test@example.com",
    "age": 25
  },
  "action": "test_upload",
  "timestamp": "2024-10-07T12:00:00Z",
  "metadata": {
    "source": "web_interface",
    "version": "1.0"
  }
}</textarea>
                </div>
                
                <div class="btn-group">
                    <button class="btn btn-primary" onclick="testPostAPI()">📤 Upload JSON</button>
                    <button class="btn btn-outline" onclick="resetJSON()">🔄 Reset</button>
                </div>
                
                <div id="postResult" class="result-box"></div>
            </div>
            
            <!-- GET Requests -->
            <div class="test-card">
                <h2><span class="method-badge badge-get">GET</span> File Requests</h2>
                <p>Test GET requests for different file types.</p>
                
                <h3>HTML Files</h3>
                <div class="btn-group">
                    <button class="btn btn-success" onclick="testGET('/index.html')">Home Page</button>
                    <button class="btn btn-success" onclick="testGET('/about.html')">Documentation</button>
                </div>
                
                <h3>Image Files</h3>
                <div class="btn-group">
                    <button class="btn btn-success" onclick="testGET('/logo.png')">PNG Image</button>
                    <button class="btn btn-success" onclick="testGET('/photo.jpg')">JPEG Image</button>
                </div>
                
                <h3>Text Files</h3>
                <div class="btn-group">
                    <button class="btn btn-success" onclick="testGET('/sample1.txt')">Sample 1</button>
                    <button class="btn btn-success" onclick="testGET('/sample2.txt')">Sample 2</button>
                </div>
                
                <div id="getResult" class="result-box"></div>
            </div>
            
            <!-- Error Testing -->
            <div class="test-card">
                <h2><span class="method-badge badge-error">ERROR</span> Error Responses</h2>
                <p>Test different HTTP error codes and security features.</p>
                
                <h3>404 Not Found</h3>
                <div class="btn-group">
                    <button class="btn btn-outline" onclick="testGET('/nonexistent.html')">Missing File</button>
                </div>
                
                <h3>405 Method Not Allowed</h3>
                <div class="btn-group">
                    <button class="btn btn-outline" onclick="testMethodNotAllowed()">DELETE Request</button>
                </div>
                
                <h3>415 Unsupported Media Type</h3>
                <div class="btn-group">
                    <button class="btn btn-outline" onclick="testUnsupportedMedia()">Invalid Content-Type</button>
                </div>
                
                <h3>403 Forbidden (Security)</h3>
                <div class="btn-group">
                    <button class="btn btn-outline" onclick="testPathTraversal()">Path Traversal</button>
                </div>
                
                <div id="errorResult" class="result-box"></div>
            </div>
            
            <!-- Advanced Testing -->
            <div class="test-card">
                <h2>🔬 Advanced Tests</h2>
                <p>Test advanced server features and performance.</p>
                
                <h3>Keep-Alive Connection</h3>
                <p>Test persistent HTTP connections with multiple requests.</p>
                <div class="btn-group">
                    <button class="btn btn-primary" onclick="testKeepAlive()">Test Keep-Alive</button>
                </div>
                
                <h3>Large File Transfer</h3>
                <p>Download and verify large binary file (26MB+).</p>
                <div class="btn-group">
                    <button class="btn btn-primary" onclick="testLargeFile()">Download Large Image</button>
                </div>
                
                <h3>Concurrent Requests</h3>
                <p>Send multiple simultaneous requests to test threading.</p>
                <div class="btn-group">
                    <button class="btn btn-primary" onclick="testConcurrent()">10 Concurrent Requests</button>
                </div>
                
                <div id="advancedResult" class="result-box"></div>
            </div>
        </div>
        
        <!-- API Documentation Section -->
        <div class="info-section">
            <h2>📋 API Reference</h2>
            <div class="endpoint-list">
                <div class="endpoint-item">
                    <h4><span class="method-badge badge-get">GET</span> /</h4>
                    <p>Returns the home page (index.html)</p>
                </div>
                
                <div class="endpoint-item">
                    <h4><span class="method-badge badge-get">GET</span> /{filename}</h4>
                    <p>Returns the requested file from resources directory. Supports .html, .png, .jpg, .txt</p>
                </div>
                
                <div class="endpoint-item">
                    <h4><span class="method-badge badge-post">POST</span> /upload</h4>
                    <p>Accepts JSON data and creates a file in resources/uploads/ directory</p>
                    <div class="code-block">
Headers: Content-Type: application/json
Body: Valid JSON object
Response: File path of created JSON file
                    </div>
                </div>
            </div>
        </div>
        
        <!-- HTTP Status Codes -->
        <div class="info-section">
            <h2>📊 HTTP Status Codes</h2>
            <div class="endpoint-list">
                <div class="endpoint-item">
                    <h4>200 OK</h4>
                    <p>Request successful, resource returned</p>
                </div>
                
                <div class="endpoint-item">
                    <h4>400 Bad Request</h4>
                    <p>Malformed HTTP request or missing Host header</p>
                </div>
                
                <div class="endpoint-item">
                    <h4>403 Forbidden</h4>
                    <p>Security violation (e.g., path traversal attempt)</p>
                </div>
                
                <div class="endpoint-item">
                    <h4>404 Not Found</h4>
                    <p>Requested resource doesn't exist</p>
                </div>
                
                <div class="endpoint-item">
                    <h4>405 Method Not Allowed</h4>
                    <p>HTTP method not supported (only GET and POST allowed)</p>
                </div>
                
                <div class="endpoint-item">
                    <h4>415 Unsupported Media Type</h4>
                    <p>Invalid Content-Type for POST or invalid JSON data</p>
                </div>
                
                <div class="endpoint-item">
                    <h4>500 Internal Server Error</h4>
                    <p>Server encountered an error while processing</p>
                </div>
                
                <div class="endpoint-item">
                    <h4>503 Service Unavailable</h4>
                    <p>Thread pool is full, server is overloaded</p>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Footer -->
    <footer>
        <p><strong>HTTP Server API Testing Interface</strong></p>
        <p>&copy; 2024 Computer Networks Project</p>
    </footer>
    
    <!-- JavaScript for Testing -->
    <script>
        // POST JSON Upload Test
        async function testPostAPI() {
            const resultDiv = document.getElementById('postResult');
            const jsonInput = document.getElementById('jsonInput').value;
            
            resultDiv.className = 'result-box loading show';
            resultDiv.innerHTML = '<h4><span class="spinner"></span> Uploading JSON...</h4>';
            
            try {
                // Validate JSON
                JSON.parse(jsonInput);
                
                const response = await fetch('/upload', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Host': 'localhost:8080'
                    },
                    body: jsonInput
                });
                
                const responseText = await response.text();
                
                if (response.ok) {
                    resultDiv.className = 'result-box success show';
                    resultDiv.innerHTML = `
                        <h4>✅ Upload Successful!</h4>
                        <div class="result-details">
                            <strong>Status:</strong> ${response.status} ${response.statusText}<br>
                            <strong>Response:</strong><br>
                            <pre>${responseText}</pre>
                        </div>
                    `;
                } else {
                    resultDiv.className = 'result-box error show';
                    resultDiv.innerHTML = `
                        <h4>❌ Upload Failed</h4>
                        <div class="result-details">
                            <strong>Status:</strong> ${response.status} ${response.statusText}<br>
                            <strong>Response:</strong><br>
                            <pre>${responseText}</pre>
                        </div>
                    `;
                }
            } catch (error) {
                resultDiv.className = 'result-box error show';
                resultDiv.innerHTML = `
                    <h4>❌ Error</h4>
                    <div class="result-details">
                        <strong>Error:</strong> ${error.message}<br>
                        <p>Check if JSON is valid or if server is running.</p>
                    </div>
                `;
            }
        }
        
        // Reset JSON to default
        function resetJSON() {
            document.getElementById('jsonInput').value = `{
  "user": {
    "name": "Test User",
    "email": "test@example.com",
    "age": 25
  },
  "action": "test_upload",
  "timestamp": "2024-10-07T12:00:00Z",
  "metadata": {
    "source": "web_interface",
    "version": "1.0"
  }
}`;
            document.getElementById('postResult').className = 'result-box';
        }
        
        // GET Request Test
        async function testGET(path) {
            const resultDiv = document.getElementById('getResult');
            resultDiv.className = 'result-box loading show';
            resultDiv.innerHTML = `<h4><span class="spinner"></span> Fetching ${path}...</h4>`;
            
            try {
                const response = await fetch(path);
                const contentType = response.headers.get('content-type');
                
                if (response.ok) {
                    resultDiv.className = 'result-box success show';
                    resultDiv.innerHTML = `
                        <h4>✅ Request Successful</h4>
                        <div class="result-details">
                            <strong>Path:</strong> ${path}<br>
                            <strong>Status:</strong> ${response.status} ${response.statusText}<br>
                            <strong>Content-Type:</strong> ${contentType}<br>
                            <strong>Content-Length:</strong> ${response.headers.get('content-length') || 'N/A'} bytes
                        </div>
                    `;
                } else {
                    const responseText = await response.text();
                    resultDiv.className = 'result-box error show';
                    resultDiv.innerHTML = `
                        <h4>❌ Request Failed</h4>
                        <div class="result-details">
                            <strong>Path:</strong> ${path}<br>
                            <strong>Status:</strong> ${response.status} ${response.statusText}<br>
                            <strong>Response:</strong><br>
                            <pre>${responseText}</pre>
                        </div>
                    `;
                }
            } catch (error) {
                resultDiv.className = 'result-box error show';
                resultDiv.innerHTML = `
                    <h4>❌ Error</h4>
                    <div class="result-details">
                        <strong>Error:</strong> ${error.message}
                    </div>
                `;
            }
        }
        
        // Method Not Allowed Test
        async function testMethodNotAllowed() {
            const resultDiv = document.getElementById('errorResult');
            resultDiv.className = 'result-box loading show';
            resultDiv.innerHTML = '<h4><span class="spinner"></span> Testing DELETE method...</h4>';
            
            try {
                const response = await fetch('/index.html', { method: 'DELETE' });
                const responseText = await response.text();
                
                if (response.status === 405) {
                    resultDiv.className = 'result-box success show';
                    resultDiv.innerHTML = `
                        <h4>✅ Correct Error Response</h4>
                        <div class="result-details">
                            <strong>Expected:</strong> 405 Method Not Allowed<br>
                            <strong>Received:</strong> ${response.status} ${response.statusText}<br>
                            <strong>Response:</strong> ${responseText}
                        </div>
                    `;
                } else {
                    resultDiv.className = 'result-box error show';
                    resultDiv.innerHTML = `
                        <h4>❌ Unexpected Response</h4>
                        <div class="result-details">
                            <strong>Expected:</strong> 405<br>
                            <strong>Received:</strong> ${response.status}
                        </div>
                    `;
                }
            } catch (error) {
                resultDiv.className = 'result-box error show';
                resultDiv.innerHTML = `<h4>❌ Error: ${error.message}</h4>`;
            }
        }
        
        // Unsupported Media Type Test
        async function testUnsupportedMedia() {
            const resultDiv = document.getElementById('errorResult');
            resultDiv.className = 'result-box loading show';
            resultDiv.innerHTML = '<h4><span class="spinner"></span> Testing invalid Content-Type...</h4>';
            
            try {
                const response = await fetch('/upload', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'text/plain',
                        'Host': 'localhost:8080'
                    },
                    body: 'plain text data'
                });
                const responseText = await response.text();
                
                if (response.status === 415) {
                    resultDiv.className = 'result-box success show';
                    resultDiv.innerHTML = `
                        <h4>✅ Correct Error Response</h4>
                        <div class="result-details">
                            <strong>Expected:</strong> 415 Unsupported Media Type<br>
                            <strong>Received:</strong> ${response.status} ${response.statusText}<br>
                            <strong>Response:</strong> ${responseText}
                        </div>
                    `;
                } else {
                    resultDiv.className = 'result-box error show';
                    resultDiv.innerHTML = `
                        <h4>❌ Unexpected Response</h4>
                        <div class="result-details">
                            <strong>Expected:</strong> 415<br>
                            <strong>Received:</strong> ${response.status}
                        </div>
                    `;
                }
            } catch (error) {
                resultDiv.className = 'result-box error show';
                resultDiv.innerHTML = `<h4>❌ Error: ${error.message}</h4>`;
            }
        }
        
        // Path Traversal Test
        async function testPathTraversal() {
            const resultDiv = document.getElementById('errorResult');
            resultDiv.className = 'result-box loading show';
            resultDiv.innerHTML = '<h4><span class="spinner"></span> Testing path traversal protection...</h4>';
            
            try {
                const response = await fetch('/../etc/passwd');
                const responseText = await response.text();
                
                if (response.status === 403) {
                    resultDiv.className = 'result-box success show';
                    resultDiv.innerHTML = `
                        <h4>✅ Security Check Passed</h4>
                        <div class="result-details">
                            <strong>Expected:</strong> 403 Forbidden<br>
                            <strong>Received:</strong> ${response.status} ${response.statusText}<br>
                            <strong>Response:</strong> ${responseText}<br>
                            <p>✅ Path traversal attack blocked successfully!</p>
                        </div>
                    `;
                } else {
                    resultDiv.className = 'result-box error show';
                    resultDiv.innerHTML = `
                        <h4>⚠️ Security Issue</h4>
                        <div class="result-details">
                            <strong>Expected:</strong> 403 Forbidden<br>
                            <strong>Received:</strong> ${response.status}<br>
                            <p>Path traversal should be blocked with 403!</p>
                        </div>
                    `;
                }
            } catch (error) {
                resultDiv.className = 'result-box error show';
                resultDiv.innerHTML = `<h4>❌ Error: ${error.message}</h4>`;
            }
        }
        
        // Keep-Alive Test
        async function testKeepAlive() {
            const resultDiv = document.getElementById('advancedResult');
            resultDiv.className = 'result-box loading show';
            resultDiv.innerHTML = '<h4><span class="spinner"></span> Testing keep-alive connection...</h4>';
            
            try {
                const response1 = await fetch('/index.html');
                const connection1 = response1.headers.get('connection');
                
                const response2 = await fetch('/about.html');
                const connection2 = response2.headers.get('connection');
                
                resultDiv.className = 'result-box success show';
                resultDiv.innerHTML = `
                    <h4>✅ Keep-Alive Test Complete</h4>
                    <div class="result-details">
                        <strong>Request 1:</strong> ${response1.status} - Connection: ${connection1}<br>
                        <strong>Request 2:</strong> ${response2.status} - Connection: ${connection2}<br>
                        <p>Both requests completed successfully on persistent connection!</p>
                    </div>
                `;
            } catch (error) {
                resultDiv.className = 'result-box error show';
                resultDiv.innerHTML = `<h4>❌ Error: ${error.message}</h4>`;
            }
        }
        
        // Large File Test
        async function testLargeFile() {
            const resultDiv = document.getElementById('advancedResult');
            resultDiv.className = 'result-box loading show';
            resultDiv.innerHTML = '<h4><span class="spinner"></span> Downloading large file (26MB+)...</h4>';
            
            try {
                const startTime = Date.now();
                const response = await fetch('/large_image.png');
                const blob = await response.blob();
                const endTime = Date.now();
                const duration = ((endTime - startTime) / 1000).toFixed(2);
                const sizeInMB = (blob.size / 1024 / 1024).toFixed(2);
                
                if (response.ok) {
                    resultDiv.className = 'result-box success show';
                    resultDiv.innerHTML = `
                        <h4>✅ Large File Transfer Successful</h4>
                        <div class="result-details">
                            <strong>File Size:</strong> ${sizeInMB} MB<br>
                            <strong>Transfer Time:</strong> ${duration} seconds<br>
                            <strong>Speed:</strong> ${(sizeInMB / duration).toFixed(2)} MB/s<br>
                            <p>✅ Binary file transferred correctly!</p>
                        </div>
                    `;
                } else {
                    resultDiv.className = 'result-box error show';
                    resultDiv.innerHTML = `<h4>❌ Transfer Failed: ${response.status}</h4>`;
                }
            } catch (error) {
                resultDiv.className = 'result-box error show';
                resultDiv.innerHTML = `<h4>❌ Error: ${error.message}</h4>`;
            }
        }
        
        // Concurrent Requests Test
        async function testConcurrent() {
            const resultDiv = document.getElementById('advancedResult');
            resultDiv.className = 'result-box loading show';
            resultDiv.innerHTML = '<h4><span class="spinner"></span> Sending 10 concurrent requests...</h4>';
            
            try {
                const startTime = Date.now();
                const promises = [];
                
                for (let i = 0; i < 10; i++) {
                    promises.push(fetch('/index.html'));
                }
                
                const responses = await Promise.all(promises);
                const endTime = Date.now();
                const duration = endTime - startTime;
                
                const successCount = responses.filter(r => r.ok).length;
                
                resultDiv.className = 'result-box success show';
                resultDiv.innerHTML = `
                    <h4>✅ Concurrent Test Complete</h4>
                    <div class="result-details">
                        <strong>Total Requests:</strong> 10<br>
                        <strong>Successful:</strong> ${successCount}<br>
                        <strong>Failed:</strong> ${10 - successCount}<br>
                        <strong>Total Time:</strong> ${duration}ms<br>
                        <p>✅ Server handled multiple concurrent connections!</p>
                    </div>
                `;
            } catch (error) {
                resultDiv.className = 'result-box error show';
                resultDiv.innerHTML = `<h4>❌ Error: ${error.message}</h4>`;
            }
        }
    </script>
</body>
</html>
